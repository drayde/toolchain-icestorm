sudo: required
dist: bionic
language: cpp
matrix:
  include:
  - os: osx
    env: TARGET=darwin EXT=tar.gz MACOSX_DEPLOYMENT_TARGET=10.10
  - os: linux
    env: TARGET=linux_x86_64 EXT=tar.gz
  - os: linux
    env: TARGET=linux_i686 EXT=tar.gz
  - os: linux
    env: TARGET=linux_armv7l EXT=tar.gz
  - os: linux
    env: TARGET=linux_aarch64 EXT=tar.gz
  - os: linux
    env: TARGET=windows_x86 EXT=zip
  - os: linux
    env: TARGET=windows_amd64 EXT=zip
script:
- bash build.sh $TARGET
- openssl sha1 _packages/**/*.$EXT
deploy:
  provider: releases
  api_key: $GH_TOKEN
  file:
    - _packages/**/*.tar.gz
    - _packages/**/*.zip
  file_glob: true
  skip_cleanup: true
  on:
    repo: drayde/toolchain-icestorm
    all_branches: true
    tags: true
branches:
  only:
    # tags
    - /^test\d+/
    - deploy-test
notifications:
  email:
    on_success: change
